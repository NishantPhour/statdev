<div class="card">
    <div class="card-body">
        <div class="row">
            <form action="" method="get" class="mt-3">
                <input type="hidden" name="action" value="search">
                <input type="hidden" name="searchaction" value="search">
              
                <!-- Row: Dates + Create button -->
                <div class="row g-3 align-items-end">
                  <div class="col-12 col-lg-4">
                    <label for="id_from_date" class="form-label">From Lodge Date:</label>
                    <input class="dateinput form-control" id="id_from_date" name="from_date" value="{{ from_date }}" type="text" autocomplete="off">
                  </div>
                  <div class="col-12 col-lg-4">
                    <label for="id_to_date" class="form-label">To Lodge Date:</label>
                    <input class="dateinput form-control" id="id_to_date" name="to_date" value="{{ to_date }}" type="text" autocomplete="off">
                  </div>
                </div>
              
                <!-- Row: Type / Status / Workflow -->
                <div class="row g-3 mt-1">
                  <div class="col-12 col-lg-6">
                    <label for="id_apptype" class="form-label">Type:</label>
                    <select class="form-select" id="id_apptype" name="apptype">
                      <option value="">All</option>
                      {% for at in app_apptypes %}
                        <option value="{{ at.0 }}" {% if apptype == at.0 %}selected{% endif %}>{{ at.1 }}</option>
                      {% endfor %}
                    </select>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label for="id_appstatus" class="form-label">Status:</label>
                    <select class="form-select" id="id_appstatus" name="appstatus">
                      <option value="">All</option>
                      {% for at in app_appstatus %}
                        <option value="{{ at.0 }}" {% if appstatus|floatformat:"0" == at.0|floatformat:"0" %}selected{% endif %}>{{ at.1 }}</option>
                      {% endfor %}
                    </select>
                  </div>
                  <div class="col-12 col-lg-3">
                    <label for="id_wfstatus" class="form-label">Workflow Step:</label>
                    <select class="form-select" id="id_wfstatus" name="wfstatus">
                      <option value="">All</option>
                      {% for at in app_wfstatus %}
                        <option value="{{ at }}" {% if wfstatus == at %}selected{% endif %}>{{ at }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                    <label for="search_field" class="form-label">Keyword:</label>
                    <input id="search_field" type="text" class="form-control" name="q" placeholder="Enter Keywords" value="{{ query_string }}">
                </div>
            
                <!-- Search Button -->
                <div class="col-12 d-flex justify-content-between">
                    <button type="submit" name="search" value="1" class="btn btn-primary mt-3">Search</button>
                        <a class="btn btn-primary mt-3" href="{% url 'application_apply' %}">Create New Application</a>
                </div>
              </form>                            
            <BR>
        </div>
        <hr>
        <div class="row">
            <div class="col-lg-12" >
                <table id='application-table' class="table table-striped table-bordered table-condensed" >
                    <thead>
                        <tr>
                            <th>Lodgement no.</th>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Applicant</th>
                            <th>Status</th>
                            <th>Lodged on</th>
                            {% if staff == True %}
                            <th>Assignee</th>
			    {% endif %}
			    <th>Submitter</th>
                            {% if staff == True %}
                            <th>Payment status</th>
                            {% endif %}
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app_obj in app_list %}
                        <tr>
                            <td><a href="{% if app_obj.app.state == 1 %}{% if app_obj.app.app_type == None %}{% url 'application_apply_form' app_obj.app.pk 'apptype' %}{% else %}{% url 'application_update' app_obj.app.pk %}{% endif %}{% else %}{% url 'application_detail' app_obj.app.pk %}{% endif %}">WO-{{ app_obj.app.pk }}</a></td>

			    <td{{ app_obj.app.get_app_type_display }}</td>
                            <td>{{ app_obj.app.title }}</td>
                            <td>{% if app_obj.app.organisation %}
                                 {{ app_obj.app.organisation }}
                                {% else %}
                                 {{ app_obj.applicant.legal_first_name }} {{ app_obj.applicant.legal_last_name }}
                                {% endif %}
                            </td>
                            <td>
                                 {% if staff == True %}
                                        {{ app_obj.app.get_state_display }}
				 {% else %}
                            	     {% if app_obj.app.state == 1 %}
                                         {{ app_obj.app.get_state_display }}
				     {% elif app_obj.app.state == 8 %}
                                         {{ app_obj.app.get_state_display }}
                                     {% elif  app_obj.app.state == 10 %} 
					{{ app_obj.app.get_state_display }}
                                     {% elif  app_obj.app.state == 14 %}
					{{ app_obj.app.get_state_display }}
				     {% else %}
					Submitted
                                     {% endif %}
				{% endif %}
                            </td>
			    <td>{{ app_obj.app.get_status_display }} </td>
                            <td>{{ app_obj.app.submit_date|date:"d-M-Y" }}</td>
                            {% if staff == True %}
                            <td>{{ app_obj.assignee.legal_first_name }} {{ app_obj.assignee.legal_last_name }}</td>
			    {% endif %}

				<td>{{ app_obj.submitted_by.legal_first_name }} {{ app_obj.submitted_by.legal_last_name }}</td>
                            {% if staff == True %} 
                            <td></td>
                            {% endif %}
                            <td>
                               <ul class="nav navbar-nav">
                                      <li class="dropdown nav-item">
                                      <a href="#" class="dropdown-toggle nav-link" data-bs-toggle="dropdown" role="button" aria-expanded="true">Actions</a>
                                      <ul class="dropdown-menu" role="menu">
					{% if app_obj.app.state == 1 %}
                                           {% if app_obj.app.app_type == None %}
                                           	<li class="nav-item"><a class="dropdown-item" href="{% url 'application_apply_form' app_obj.app.pk 'apptype' %}" title="View">Continue</a></li>
				           {% else %}
						<li class="nav-item"><a class="dropdown-item" href="{% url 'application_update' app_obj.app.pk %}" title="View">Continue</a></li>
					   {% endif %}
					<li class="nav-item"><a class="dropdown-item" href="{% url 'application_discard' app_obj.app.pk %}" title="View">Discard</a></li>
					{% else %}
							<li class="nav-item"><a class="dropdown-item" href="{% url 'application_detail' app_obj.app.pk %}" title="View">View</a></li>
					{% endif %}
                                     </ul>
                                     </li>
                                    </ul>

				

				</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <script>
function loadTable() {
    $('#application-table').dataTable({searching: false, paging: true, "pageLength": 10, "order": [[ 0, "desc" ]],
     columnDefs: [
       { type: 'natural-nohtml', targets: 0 }, { type: 'date-dd-mmm-yyyy', targets: 5 }, { 'bSortable': false, 'aTargets':  {% if staff == True %}9{% else %}7{% endif %} }
     ]
// "aoColumnDefs": [
//          { 'bSortable': false, 'aTargets': [ {% if staff == True %}9{% else %}7{% endif %} ] }
//       ]

});
}
window.onload= function() {
    loadTable();
}
    </script>

