{% extends "base_statdev.html" %}

{% block page_content_inner %}

{% if request.user.is_authenticated %}
{% if admin_staff == True %}
<div class="card mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-lg-8">
          <h1 class="h3">Welcome to the Swan Canning Riverpark online application system dashboard.</h1>
          <p class="mt-3">Please select an area:</p>
        </div>
      </div>
    </div>
  </div>

  <div class="list-group">
    <a href="{% url 'application_list' %}" class="list-group-item list-group-item-action">Applications</a>
    <a href="{% url 'approval_list' %}" class="list-group-item list-group-item-action">Approvals</a>
    <a href="{% url 'compliance_list' %}" class="list-group-item list-group-item-action">Clearance of Conditions</a>
    <a href="{% url 'search_list' %}" class="list-group-item list-group-item-action">Search</a>
  </div>

{% else %}

<div class="card mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-lg-8">
          <h1 class="h3">Welcome to the Swan Canning Riverpark online application system dashboard.</h1>
          <p class="mt-3">
            Here you can access your existing approvals, view any applications in progress, lodge new applications or submit information required to clear conditions of your approvals.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link {{ home_nav_other_applications }}" href="{% url 'home' %}">Applications</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{ home_nav_other_approvals }}" href="{% url 'home_page_tabs' 'approvals' %}">Approvals</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{ home_nav_other_clearance }}" href="{% url 'home_page_tabs' 'clearance' %}">Clearance of Conditions</a>
      </li>
      {% if referee == 'yes' %}
        <li class="nav-item">
          <a class="nav-link {{ home_nav_other_referral }}" href="{% url 'home_page_tabs' 'referrals' %}">Referrals</a>
        </li>
      {% endif %}
    </ul>
    <br>
  </div>
  

<div class="col-sm-12 col-md-12 col-lg-12" >
    {% if home_nav_other_applications == 'active' %}
        {% include "applications/person_other_applications.html" %}
    {% elif home_nav_other_approvals == 'active' %}
        {% include "applications/person_other_approvals.html" %}
    {% elif home_nav_other_clearance == 'active' %}
        {% include "applications/person_other_clearance.html" %}
    {% elif home_nav_other_referral == 'active' %}
	{% include "applications/referral_applications.html" %}
    {% endif %}
</div>

{% endif %}


{% else %}

        <div class="container px-4 pt-4">
            <div class="row">
                <div class="col-md-8">
                    <h2 class="mb-4">
                        Welcome to the Swan Canning Riverpark online application system
                    </h2>
                    {% comment %}
                    <div>
                        TODO: Add home content for unauthenticated user here.
                    </div>
                    {% endcomment %}
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <strong>Access Swan Canning Riverpark online application system</strong>
                        </div>
                        <div class="card-body">
                            <p>
                                At the Department of Biodiversity, Conservation and Attractions, we employ a password-less authentication system, meaning you never need to remember
                                a password. When you need to login to a site, such as Swan Canning Riverpark online application system, simply enter your email and an
                                authentication link will be sent to your registered email address. From there, simply follow the link to complete the login process.
                            </p>
                            <a href="/ssologin" class="btn btn-primary">Login</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row">
            <div class="col-xs-12">
                {% if may_create %}
                <a class="btn btn-primary pull-right" href="{% url 'application_apply' %}">Create a new application</a>
                {% endif %}
            </div>
        </div>
        {% if applications_unassigned %}
        <div class="row">
            <div class="col-xs-12">
                <h1>Unassigned lodged applications:</h1>
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>Lodgement no.</th>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Applicant</th>
                            <th>Company</th>
                            <th>Status</th>
                            <th>Lodged on</th>
                            <th>Assignee</th>
                            <th>Payment status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app_obj in applications_unassigned %}
                        <tr>
                            <td><a href="{% url 'application_detail' app_obj.app.pk %}">{{ app_obj.app.pk }}</a></td>
                            <td>{{ app_obj.app.get_app_type_display }}</td>
                            <td>{{ app_obj.app.title }}</td>
                            <td>{{ app_obj.applicant.legal_first_name }} {{ app_obj.applicant.legal_last_name }}</td>
                            <td>{{ app_obj.app.organisation }}</td>
                            <td>{{ app_obj.app.get_state_display }}</td>
                            <td>{{ app_obj.app.submit_date|date:"d-M-Y" }}</td>
                            <td>{{ app_obj.assignee.legal_first_name }} {{ app_obj.assignee.legal_last_name }}</td>
                            <td></td>
                            <td>
                                {% if app_obj.may_assign_to_person == "True" %}
                                <a class="btn btn-primary btn-sm" role="button" href="{% url 'application_assign_person' app_obj.app.pk %}">{% if app_obj.app.assignee == None %}Assign{% else %}Re Assign {% endif %}</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        {% if applications_wip %}
        <div class="row">
            <div class="col-xs-12">
                <h1>Applications assigned to me (in progress):</h1>
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>Lodgement no.</th>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Applicant</th>
                            <th>Company</th>
                            <th>Status</th>
                            <th>Lodged on</th>
                            <th>Assignee</th>
                            <th>Payment status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app_obj in applications_wip %}
                        <tr>
                            <td><a href="{% url 'application_detail' app_obj.app.pk %}">{{ app_obj.app.pk }}</a></td>
                            <td>{{ app_obj.app.get_app_type_display }}</td>
                            <td>{{ app_obj.app.title }}</td>
                            <td>{{ app_obj.applicant.legal_first_name }} {{ app_obj.applicant.legal_last_name }}</td>
                            <td>{{ app_obj.app.organisation }}</td>
                            <td>{{ app_obj.app.get_state_display }}</td>
                            <td>{{ app_obj.app.submit_date|date:"d-M-Y" }}</td>
                            <td>{{ app_obj.assignee.legal_first_name }} {{ app_obj.assignee.legal_last_name }}</td>
                            <td></td>
                            <td>
                                {% if app_obj.may_assign_to_person == "True" %}
                                <a class="btn btn-primary btn-sm" role="button" href="{% url 'application_assign_person' app_obj.app.pk %}">{% if app_obj.assignee == None %}Assign{% else %}Re Assign {% endif %}</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %} 
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        {% if applications_groups %}
        <div class="row">
            <div class="col-xs-12">
                <h1>Applications assigned to my groups (in progress):</h1>
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>Lodgement no.</th>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Applicant</th>
                            <th>Company</th>
                            <th>Status</th>
                            <th>Lodged on</th>
                            <th>Assignee</th>
                            <th>Payment status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app_obj in applications_groups %}
                        <tr>
                            <td><a href="{% url 'application_detail' app_obj.app.pk %}">{{ app_obj.app.pk }}</a></td>
                            <td>{{ app_obj.app.get_app_type_display }}</td>
                            <td>{{ app_obj.app.title }}</td>
                            <td>{{ app_obj.applicant.legal_first_name }} {{ app_obj.applicant.legal_last_name }}</td>
                            <td>{{ app_obj.app.organisation }}</td>
                            <td>{{ app_obj.app.get_state_display }}</td>
                            <td>{{ app_obj.app.submit_date|date:"d-M-Y" }}</td>
                            <td>{{ app_obj.assignee.legal_first_name }} {{ app_obj.assignee.legal_last_name }}</td>
                            <td></td>
                            <td>
                                {% if app_obj.may_assign_to_person == "True" %}
                                <a class="btn btn-primary btn-sm" role="button" href="{% url 'application_assign_person' app_obj.app.pk %}">{% if app_obj.app.assignee == None %}Assign{% else %}Re Assign {% endif %}</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}


        {% if applications_submitted %}
        <div class="row">
            <div class="col-xs-12">
                <h1>My submitted applications:</h1>
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>Lodgement no.</th>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Applicant</th>
                            <th>Company</th>
                            <th>Status</th>
                            <th>Lodged on</th>
                            <th>Assigned To</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app_obj in applications_submitted %}
                        <tr>
                            <td><a href="{% url 'application_detail' app_obj.app.pk %}">{{ app_obj.app.pk }}</a></td>
                            <td>{{ app_obj.app.get_app_type_display }}</td>
                            <td>{{ app_obj.app.title }}</td>
                            <td>{{ app_obj.applicant.legal_first_name }} {{ app_obj.applicant.legal_last_name }}</td>
                            <td>{{ app_obj.app.organisation }}</td>
                            <td>{{ app_obj.app.get_state_display }}</td>
                            <td>{{ app_obj.app.submit_date|date:"d-M-Y" }}</td>
                            <td>{{ app_obj.assignee.legal_first_name }} {{ app_obj.assignee.legal_last_name }}</td>
                            <td>
                                {% if app_obj.may_assign_to_person == "True" %}
                                <a class="btn btn-primary btn-sm" role="button" href="{% url 'application_assign_person' app_obj.app.pk %}">{% if app_obj.app.assignee == None %}Assign{% else %}Re Assign {% endif %}</a>
                                {% endif %}
                            </td>

                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        {% if referrals %}
        <div class="row">
            <div class="col-xs-12">
                <h1>Applications referred to me for comment:</h1>
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>Lodgement no.</th>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Applicant</th>
                            <th>Company</th>
                            <th>Lodged on</th>
                            <th>Expiry</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for obj in referrals %}
                        <tr>
                            <td><a href="{% url 'application_detail' obj.application.pk %}">{{ obj.application.pk }}</a></td>
                            <td>{{ obj.application.get_app_type_display }}</td>
                            <td>{{ obj.application.title }}</td>
                            <td>{{ app_obj.applicant.legal_first_name }} {{ app_obj.applicant.legal_last_name }}</td>
                            <td>{{ obj.application.organisation }}</td>
                            <td>{{ obj.application.submit_date|date:"d-M-Y" }}</td>
                            <td>{{ obj.expire_date|date:"d-M-Y" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        {% endblock %}
